<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Technical Background to predRupdate • predRupdate</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Technical Background to predRupdate">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">predRupdate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/predRupdate.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/predRupdate_splineIllustration.html">Example of Validating a Model that Includes Spline Terms</a></li>
    <li><a class="dropdown-item" href="../articles/predRupdate_technical.html">Technical Background to predRupdate</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GlenMartin31/predRupdate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Technical Background to predRupdate</h1>
                        <h4 data-toc-skip class="author">Glen P. Martin,
PhD; David Jenkins, PhD; Matthew Sperrin, PhD</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GlenMartin31/predRupdate/blob/master/vignettes/predRupdate_technical.Rmd" class="external-link"><code>vignettes/predRupdate_technical.Rmd</code></a></small>
      <div class="d-none name"><code>predRupdate_technical.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="preamble">Preamble<a class="anchor" aria-label="anchor" href="#preamble"></a>
</h2>
<p>The <strong>predRupdate</strong> package includes a set of functions
to aid in the validation of a clinical prediction model (CPM) on a given
dataset, and to apply various model updating and aggregation methods.
This vignette aims to overview the technical details of the methods that
are implemented within the <strong>predRupdate</strong> package. For an
introduction to using the package, please see
<code><a href="../articles/predRupdate.html">vignette("predRupdate")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="clinical-prediction-models">Clinical Prediction Models<a class="anchor" aria-label="anchor" href="#clinical-prediction-models"></a>
</h2>
<p>Clinical prediction models (CPMs) are statistical models that aim to
predict the presence (diagnostic models) or future occurrence
(prognostic models) of an outcome of interest for an individual, using
information (predictor variables) that are available about that
individual at the time the prediction is made. For example, we might use
someone’s age, sex, smoking status and family medical history to predict
their risk of developing cardiovascular disease in the next ten years.
These models can be used to aid clinical decision-making, form the
cornerstone of decision support systems, and underpin clinical audit and
feedback tasks.</p>
<p>The usual stages for the production of CPMs are: (i) model
development and internal validation, (ii) external validation in new
data, potentially with updating as needed, and (iii) impact assessment.
These are summarised in the table below:</p>
<table class="table">
<caption>Phases of clinical prediction model production</caption>
<colgroup>
<col width="11%">
<col width="88%">
</colgroup>
<thead><tr class="header">
<th align="left">Phase</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(i) Model Development and internal validation</td>
<td align="left">The development of the model uses a cohort of patients,
where the predictor variables and outcomes are known, to perform
variable selection and estimate the prognostic effect (coefficient) of
each predictor on the outcome of interest. This is followed by
assessment of predictive performance within that data, adjusting for
in-sample optimism</td>
</tr>
<tr class="even">
<td align="left">(ii) External validation</td>
<td align="left">Aims to assess the predictive performance of the
developed model in data that are different to those used to develop the
model (e.g., temporally or geographically different). If performance is
deemed unsuitable, the model may undergo updating to tailor it more
closely to the new data</td>
</tr>
<tr class="odd">
<td align="left">(iii) Impact Assessment</td>
<td align="left">Impact assessment investigates the extent to which the
model changes clinical practice and improves patient outcomes</td>
</tr>
</tbody>
</table>
<p>The aim of <strong>predRupdate</strong> is to provide tools for stage
(ii). Specifically, the package is intended for the situation where a
CPM has already been developed (e.g., a model available in the
literature), and one wishes to apply the model to a new dataset for
validation, updating, or both. The package assumes that one has access
to the reported model parameters (all those that are required to make a
prediction of risk for a new observation) and an individual participant
dataset in which one wishes to apply the model.</p>
<p>This vignette is not intended to be a detailed tutorial of prediction
modelling. For that, we refer readers to Riley et al. 2019 and
Steyerberg 2009. Instead, this vignette is intended to describe the
technical details of how certain methodologies have been implemented in
<strong>predRupdate</strong>.</p>
</div>
<div class="section level2">
<h2 id="predictive-performance-metrics">Predictive Performance Metrics<a class="anchor" aria-label="anchor" href="#predictive-performance-metrics"></a>
</h2>
<p>The predictive performance of a CPM is summarised by its calibration,
discrimination and overall accuracy. We provide a brief overview of the
technical details that are implemented in <strong>predRupdate</strong>
in the <code><a href="../reference/pred_validate.html">pred_validate()</a></code> function, but refer readers to the
literature for a detailed overview (Riley et al. 2019; Steyerberg et
al. 2013; Moons et al. 2012; Altman and Royston 2000; Van Calster et
al. 2016; McLernon et al. 2023).</p>
<div class="section level3">
<h3 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h3>
<p>Calibration is the agreement of the predicted risks from the CPM with
the observed risks in the validation dataset, across the full risk
range. A primary method of assessing calibration is to produce a
flexible calibration plot, which graphically depicts the estimated risk
(x-axis) and the observed probabilities (y-axis). The observed
probabilities are obtained by regressing the observed outcomes in the
validation dataset against the linear predictor (calculated for each
individual in the validation dataset), using loess or splines.</p>
<p>Specifically, suppose an existing (logistic regression) CPM has been
developed (in another dataset) to predict the probability of a binary
outcome,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.
This CPM is given by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>π</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>2</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mi>P</mi></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>P</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
\log\left(\frac{\pi_i}{1-\pi_i}\right) = \hat{\beta}_0 + \hat{\beta}_1X_{i,1} + \hat{\beta}_2X_{i,2} + ... + \hat{\beta}_PX_{i,P}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>i</mi></msub><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_{i} = P(Y_i = 1)</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mi>P</mi></msub></mrow><annotation encoding="application/x-tex">\hat{\beta}_{0},...\hat{\beta}_{P}</annotation></semantics></math>
being the estimated set of regression coefficients (log odds ratios;
taken from the original development of the model) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>p</mi></mrow></msub><annotation encoding="application/x-tex">X_{i,p}</annotation></semantics></math>
the value of predictor variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
for individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
This linear combination of the regression coefficients and predictor
variables is the linear predictor of the model.</p>
<p>To obtain a flexible calibration plot of this model within the
validation data, <code><a href="../reference/pred_validate.html">pred_validate()</a></code> fits the following model
to the validation data:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>π</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\log\left(\frac{\pi_i}{1-\pi_i}\right) = \alpha_0 + s(LP_i)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s(.)</annotation></semantics></math>
is some smooth function; in <code><a href="../reference/pred_validate.html">pred_validate()</a></code> this is a
natural cubic spline. This model is then used to obtain observed
probabilities for each individual in the validation dataset, which are
plotted against the corresponding predicted risks obtained from the CPM.
A resulting curve close to the diagonal (y=x line) indicates that
predicted risks correspond well to observed proportions. In
<code><a href="../reference/pred_validate.html">pred_validate()</a></code>, a histogram of the predicted risk
distribution is overlaid with the calibration plot, to visually
summarise the probability distribution.</p>
<p>If validating an existing time-to-event CPM,
<code><a href="../reference/pred_validate.html">pred_validate()</a></code> produces the flexible calibration plot
using methods similar to those described above for logistic regression
models. Here, the observed probabilities are obtained by fitting a Cox
proportional hazards model to regress the linear predictor of the model
(under natural cubic spline) against the time-to-event outcome in the
validation dataset. A time horizon must also be specified (i.e., the
time during follow-up in which to assess calibration). Such a plot can
only be produced for an existing time-to-event CPM if the cumulative
baseline hazard of the model is supplied.</p>
<p>Alongside flexible calibration plots, <code><a href="../reference/pred_validate.html">pred_validate()</a></code>
also calculates the calibration slope. The calibration slope (ideal
value 1) indicates the level of over-fitting of the model, with values
less than 1 indicating more over-fitting. In
<code><a href="../reference/pred_validate.html">pred_validate()</a></code> this is estimated by fitting a logistic
regression model (if the existing CPM is a logistic model) or Cox
proportion hazards model (if the existing CPM is a survival model) to
the observed outcomes in the validation dataset with the linear
predictor from the CPM as the only covariate.</p>
<p>Finally, calibration-in-the-large summarises how close the mean
predicted risk is to the mean outcome proportion in the validation
dataset. If validating a logistic regression CPM, this is quantified
using the calibration intercept, estimated using the same model as
estimating the calibration slope, with the slope fixed at unity. Here, a
calibration intercept less than 0 would indicate that the mean predicted
risk is higher than the observed outcome proportion. If validating a
time-to-event (survival) CPM, then calibration-in-the-large is
quantified with the observed:expected ratio (ideal value 1) at a fixed
time horizon. Here, the observed proportion is obtained using
Kaplan-Meier estimate. Such a metric can only be produced for an
existing time-to-event CPM if the cumulative baseline hazard of the
model is supplied such that the predicted risks at the time horizon can
be calculated.</p>
</div>
<div class="section level3">
<h3 id="discrimination">Discrimination<a class="anchor" aria-label="anchor" href="#discrimination"></a>
</h3>
<p>Discrimination of a CPM is the ability of the model to differentiate
those who experience the outcome from those who do not; i.e., does the
model estimate a higher predicted risk, on average, for those who
experience the outcome, compared to those who do not experience the
outcome. For validating logistic regression CPMs,
<code><a href="../reference/pred_validate.html">pred_validate()</a></code> calculates the area under the receiver
operating characteristic curve (AUC) of the CPM. For validating
time-to-event (survival) CPMs, <code><a href="../reference/pred_validate.html">pred_validate()</a></code> calculates
Harrell’s C-statistic. An AUC/ C-statistic of 0.5 would indicate
discrimination no better than chance, whereas a value of 1 indicates
perfect calibration.</p>
</div>
<div class="section level3">
<h3 id="overall-accuracy">Overall Accuracy<a class="anchor" aria-label="anchor" href="#overall-accuracy"></a>
</h3>
<p>For validating a logistic regression model,
<code><a href="../reference/pred_validate.html">pred_validate()</a></code> also produces two additional metrics of
overall accuracy of the model. The first is the Cox-Snell and Nagelkerke
R-squared values. Here, higher R-squared values indicate better overall
performance of the model.</p>
<p>The Cox-Snell R-squared is estimated by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>R</mi><mrow><mi>C</mi><mi>S</mi></mrow><mn>2</mn></msubsup><mo>=</mo><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo>−</mo><mi>L</mi><mi>R</mi></mrow><mi>n</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
R^{2}_{CS} = 1 - \exp\left(\frac{-LR}{n}\right)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">LR</annotation></semantics></math>
is the likelihood ratio statistic, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is the size of the validation dataset. Specifically,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>R</mi><mo>=</mo><mo>−</mo><mn>2</mn><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>L</mi><mrow><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow></msub><mo>−</mo><msub><mi>L</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
LR = -2(L_{null} - L_{model})
</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><annotation encoding="application/x-tex">L_{model}</annotation></semantics></math>
being the log-likelihood of the CPM on the validation dataset, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mrow><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow></msub><annotation encoding="application/x-tex">L_{null}</annotation></semantics></math>
is the log-likelihood of an intercept-only model in the validation
dataset. Nagelkerke R-squared is then a scaled version of Cox-Snell
R-squared, such that 1 is the ‘best’ value (unlike Cox-Snell
R-squared).</p>
<p>Finally, the Brier score of the logistic regression CPM is also
calculated, as the average squared difference between the observed
outcome and the predicted risks from the model.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-updating-methods">Model Updating Methods<a class="anchor" aria-label="anchor" href="#model-updating-methods"></a>
</h2>
<p>Upon validating an existing CPM in new data (external validation) it
is not uncommon to find that the models predictive performance
deteriorates. Rather than developing a new model, an alternative
strategy is to apply model updating methods. See Moons et al. 2012 and
Su et al. 2018 for a detailed overview of these methods. The extent of
model updating depends on the issues identified during model
validation.</p>
<p>If the model validation identifies that the CPM has poor
calibration-in-the-large, then a simple updating strategy is “intercept
update”. For a logistic regression CPM, <code><a href="../reference/pred_update.html">pred_update()</a></code> fits
the following model in the new dataset using maximum likelihood
estimation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>π</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><mi>L</mi><msub><mi>P</mi><mi>i</mi></msub><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mi>P</mi></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>P</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\log\left(\frac{\pi_i}{1-\pi_i}\right) = \alpha_0 + LP_i = \alpha_0 + (\hat{\beta}_0 + \hat{\beta}_1X_{i,1} + ... + \hat{\beta}_PX_{i,P})
</annotation></semantics></math></p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\alpha_0</annotation></semantics></math>
serves to update the intercept of the original model such that the mean
predicted risk from the (updated) CPM matches the observed event
proportion in the new dataset. Specifically, the new intercept will be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\alpha_0 + \hat{\beta}_0</annotation></semantics></math>.
All other terms
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>1</mn></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>β</mi><mi>P</mi></msub></mrow><annotation encoding="application/x-tex">\beta_{1},...,\beta_{P}</annotation></semantics></math>)
remain the same as originally published.</p>
<p>Often, the original model will also demonstrate elements of
over-fitting (i.e., the calibration slope of the model is &lt;1 in the
validation data). In such a case, the model can be re-calibrated in the
new dataset. For a logistic regression CPM, <code><a href="../reference/pred_update.html">pred_update()</a></code>
fits the following model in the new dataset using maximum likelihood
estimation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>π</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><mi>L</mi><msub><mi>P</mi><mi>i</mi></msub><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mi>P</mi></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>P</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\log\left(\frac{\pi_i}{1-\pi_i}\right) = \alpha_0 + \alpha_1LP_i = \alpha_0 + \alpha_1(\hat{\beta}_0 + \hat{\beta}_1X_{i,1} + ... + \hat{\beta}_PX_{i,P})
</annotation></semantics></math></p>
<p>This has the effect of multiplying each original model coefficient by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\alpha_1</annotation></semantics></math>.
Specifically, the new (updated) regression coefficients will be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mn>1</mn></msub><mo>×</mo><mi>β</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">\alpha_1 \times \beta{p}</annotation></semantics></math>,
and the new model intercept is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mn>1</mn></msub><mo>×</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha_0 + (\alpha_1 \times \hat{\beta}_0)</annotation></semantics></math>.</p>
<p>Neither of the above methods alter the discrimination of the model
within the new dataset. For this, one option is to refit the model to
the new dataset. Here, one would fit the following model in the new
dataset using maximum likelihood estimation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>π</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mo>+</mo><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>2</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mi>P</mi></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>P</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
\log\left(\frac{\pi_i}{1-\pi_i}\right) = \hat{\alpha}_0 + \hat{\alpha}_1X_{i,1} + \hat{\alpha}_2X_{i,2} + ... + \hat{\alpha}_PX_{i,P}
</annotation></semantics></math></p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mn>0</mn></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>α</mi><mi>P</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_{0},...,\alpha_{P}</annotation></semantics></math>
become the new regression coefficients of the updated model. There is
also a less extreme version of model refitting, where one only
re-estimates certain parameters. This will be implemented into the
package in the near future.</p>
<p>While we describe the updating methods above for logistic regression
models, <strong>predRupdate</strong> also implements these approaches
for time-to-event (survival) CPMs. The principles above are similar,
expect the underlying model is changed to a Cox proportional hazards
model (further parametric/ flexible parametric methods to be added in
the future). Specifically, “intercept update” for a survival
(time-to-event) CPM, has the following form:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mi>P</mi></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>P</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
h(t|X) = h_0(t)\exp(LP_i) = h_0(t)\exp(\hat{\beta}_1X_{i,1} + ... + \hat{\beta}_PX_{i,P})
</annotation></semantics></math></p>
<p>which has the effect of only re-estimating the baseline hazard in the
new data. For re-calibration, the updated survival (time-to-event) CPM
would be:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mn>1</mn></msub><mi>L</mi><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mi>P</mi></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>P</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
h(t|X) = h_0(t)\exp(\alpha_1LP_i) = h_0(t)\exp(\alpha_1(\hat{\beta}_1X_{i,1} + ... + \hat{\beta}_PX_{i,P}))
</annotation></semantics></math> This has the effect of multiplying each
original model coefficient (log-hazard ratios) by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\alpha_1</annotation></semantics></math>,
and estimating a new baseline hazard in the new data.</p>
</div>
<div class="section level2">
<h2 id="model-aggregation-methods">Model Aggregation Methods<a class="anchor" aria-label="anchor" href="#model-aggregation-methods"></a>
</h2>
<p>In some situations, there are instances where multiple existing CPMs
are available for the same prediction task (e.g., existing models
developed across different countries). Here, model aggregation methods
can be used to pool these existing CPMs into a single model in the new
data. Various methods exist for this (Martin et al. 2017), with
<strong>predRupdate</strong> currently implementing stacked regression
(Debray et al. 2014) through <code><a href="../reference/pred_stacked_regression.html">pred_stacked_regression()</a></code>.
More methods will be added in the future.</p>
<p>Specifically, suppose there are a collection of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
existing logistic regression CPMs, which all aim to predict the same
binary outcome,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
but where developed in different populations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">j=1,...,M</annotation></semantics></math>.
The models may contain different predictor variables. Each model has a
linear predictor (LP) given by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>π</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mrow><mn>0</mn><mo>,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mrow><mn>1</mn><mo>,</mo><mi>j</mi></mrow></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mrow><mn>2</mn><mo>,</mo><mi>j</mi></mrow></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mn>2</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mrow><mi>P</mi><mo>,</mo><mi>j</mi></mrow></msub><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>P</mi></mrow></msub><mo>=</mo><mi>L</mi><msub><mi>P</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
\log\left(\frac{\pi_i}{1-\pi_i}\right) = \hat{\beta}_{0,j} + \hat{\beta}_{1,j}X_{i,1} + \hat{\beta}_{2,j}X_{i,2} + ... + \hat{\beta}_{P,j}X_{i,P} = LP_{i,j}
</annotation></semantics></math></p>
<p>In this notation, if a given variable is not included in a given CPM,
then the corresponding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is equal to zero. One can then apply these models to each observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in the validation set to calculate the set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
linear predictors. <code><a href="../reference/pred_stacked_regression.html">pred_stacked_regression()</a></code> then applies
stacked regression by regressing these set of linear predictors against
the observed outcome in the validation dataset as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>π</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>γ</mi><mn>0</mn></msub><mo>+</mo><msub><mi>γ</mi><mn>1</mn></msub><mi>L</mi><msub><mi>P</mi><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mi>γ</mi><mi>M</mi></msub><mi>L</mi><msub><mi>P</mi><mrow><mi>i</mi><mo>,</mo><mi>M</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
\log\left(\frac{\pi_i}{1-\pi_i}\right) = \gamma_0 + \gamma_1LP_{i,1} + ... + \gamma_MLP_{i,M}
</annotation></semantics></math></p>
<p>This equation can be re-arranged to express in terms of the set of
new (aggregated) predictor coefficients for each of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>
predictor variables. Given that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
existing models all aim to predict the same outcome, there could be a
high level of co-linearity in the set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
linear predictors. Therefore, there have been suggestions to fit the
above stacked regression model under the constraint that all of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mn>1</mn></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><msub><mi>γ</mi><mi>M</mi></msub></mrow><annotation encoding="application/x-tex">\gamma_1,...\gamma_M</annotation></semantics></math>
should be non-negative. <code><a href="../reference/pred_stacked_regression.html">pred_stacked_regression()</a></code>
implements stacked regression with and without this constraint.</p>
<p><code><a href="../reference/pred_stacked_regression.html">pred_stacked_regression()</a></code> can also implement stacked
regression for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
existing time-to-event (survival) CPMs. The technical details are
similar to those described above for logistic models, with the exception
that the underlying model is changed to a Cox proportional hazards
model.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Riley RD, et al. Prognosis Research in Healthcare: Oxford University
Press; 2019</li>
<li>Steyerberg EW. Clinical Prediction Models: Springer New York;
2009</li>
<li>Riley RD, Hayden JA, Steyerberg EW, et al. Prognosis research
strategy (PROGRESS) 2: Prognostic factor research. PLoS Med
2013;10:e1001380–e1001380</li>
<li>Steyerberg EW, Moons KG, van der Windt DA, et al. Prognosis research
strategy (PROGRESS) 3: prognostic model research. PLoS Med
2013;10:e1001381–e1001381</li>
<li>Moons KGM, Kengne AP, Grobbee DE, et al Risk prediction models: II.
External validation, model updating, and impact assessment Heart
2012;98:691-698.</li>
<li>Altman, D.G. and Royston, P. What do we mean by validating a
prognostic model?. Statist. Med., 2000;19:453-473.</li>
<li>Van Calster, B., Nieboer, D., Vergouwe, Y., et al. A calibration
hierarchy for risk models was defined: from utopia to empirical data. J.
Clin. Epidemiol. 2016;74:167-176</li>
<li>McLernon, D.J., Giardiello, D., Van Calster, B. et al. Assessing
Performance and Clinical Usefulness in Prediction Models With Survival
Outcomes: Practical Guidance for Cox Proportional Hazards Models. Ann
Intern Med. 2023;176:105-114</li>
<li>Su T-L, Jaki T, Hickey GL, Buchan I, Sperrin M. A review of
statistical updating methods for clinical prediction models. Statistical
Methods in Medical Research. 2018;27(1):185-197</li>
<li>Martin, G.P., Mamas, M.A., Peek, N. et al. Clinical prediction in
defined populations: a simulation study investigating when and how to
aggregate existing models. BMC Med Res Methodol. 2017;17(1)</li>
<li>Debray TP, Koffijberg H, Nieboer D, Vergouwe Y, Steyerberg EW, Moons
KG. Meta-analysis and aggregation of multiple published prediction
models. Stat Med. 2014;33(14):2341-62</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Glen P. Martin, David Jenkins, Matthew Sperrin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
