<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Validate Predicted Probabilities — pred_val_probs • predRupdate</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validate Predicted Probabilities — pred_val_probs"><meta name="description" content="This function is included for situations where one has a vector of predicted
probabilities from a model and a vector of observed binary outcomes that we
wish to validate the predictions against. See pred_validate for
the main validation function of this package."><meta property="og:description" content="This function is included for situations where one has a vector of predicted
probabilities from a model and a vector of observed binary outcomes that we
wish to validate the predictions against. See pred_validate for
the main validation function of this package."><meta property="og:image" content="https://glenmartin31.github.io/predRupdate/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">predRupdate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/predRupdate.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/predRupdate_splineIllustration.html">Example of Validating a Model that Includes Spline Terms</a></li>
    <li><a class="dropdown-item" href="../articles/predRupdate_technical.html">Technical Background to predRupdate</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GlenMartin31/predRupdate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Validate Predicted Probabilities</h1>
      <small class="dont-index">Source: <a href="https://github.com/GlenMartin31/predRupdate/blob/v0.2.1/R/pred_val_probs.R" class="external-link"><code>R/pred_val_probs.R</code></a></small>
      <div class="d-none name"><code>pred_val_probs.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is included for situations where one has a vector of predicted
probabilities from a model and a vector of observed binary outcomes that we
wish to validate the predictions against. See <code><a href="pred_validate.html">pred_validate</a></code> for
the main validation function of this package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pred_val_probs</span><span class="op">(</span><span class="va">binary_outcome</span>, <span class="va">Prob</span>, cal_plot <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-binary-outcome">binary_outcome<a class="anchor" aria-label="anchor" href="#arg-binary-outcome"></a></dt>
<dd><p>vector of binary outcomes (coded as 1 if outcome
happened, and 0 otherwise). Must be of same length as Prob</p></dd>


<dt id="arg-prob">Prob<a class="anchor" aria-label="anchor" href="#arg-prob"></a></dt>
<dd><p>vector of predicted probabilities. Must be of same length of
binary_outcome.</p></dd>


<dt id="arg-cal-plot">cal_plot<a class="anchor" aria-label="anchor" href="#arg-cal-plot"></a></dt>
<dd><p>indicate if a flexible calibration plot should be produced
(TRUE) or not (FALSE).</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>the confidence level required for all performance metrics.
Defaults at 95%. Must be a value between 0 and 1.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further plotting arguments for the calibration plot. See Details
below.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class "<code>predvalidate</code>", which is a list containing
relevant calibration and discrimination measures. See
<code><a href="pred_validate.html">pred_validate</a></code> for details.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function takes a vector of observed binary outcomes, and a
corresponding vector of predicted risks (e.g. from a logistic regression
CPM), and calculates measures of predictive performance. The function is
intended as a standalone way of validating predicted risks against binary
outcomes outside of the usual pred_input_info() -&gt; pred_validate() package
workflow. See <code><a href="pred_validate.html">pred_validate</a></code> for the main validation function
of this package.</p>
<p>Various metrics of calibration (agreement between the observed risk and the
predicted risks, across the full risk range) and discrimination (ability
of the model to distinguish between those who develop the outcome and
those who do not) are calculated. For calibration, the observed-to-expected
ratio, calibration intercept and calibration slopes are estimated. The
calibration intercept is estimated by fitting a logistic regression model
to the observed binary outcomes, with the linear predictor of the model as
an offset. For calibration slope, a logistic regression model is fit to the
observed binary outcome with the linear predictor from the model as the
only covariate. For discrimination, the function estimates the area under
the receiver operating characteristic curve (AUC). Various other metrics
are also calculated to assess overall accuracy (Brier score, Cox-Snell R2).</p>
<p>A flexible calibration plot is produced. Specify parameter
<code>cal_plot</code> to indicate whether a calibration plot should be produced
(TRUE), or not (FALSE). See <code><a href="pred_validate.html">pred_validate</a></code> for details on
this plot, and details of optional plotting arguments.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="pred_input_info.html">pred_input_info</a></code>, <code><a href="pred_validate.html">pred_validate</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># simulate some data for purposes of example illustration</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">LP</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0.5</span><span class="op">*</span><span class="va">x1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">PR</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">LP</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">1</span>, <span class="va">PR</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#fit hypothetical model to the simulated data</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span> <span class="op">~</span> <span class="va">x1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#obtain the predicted risks from the model</span></span></span>
<span class="r-in"><span><span class="va">pred_risk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span>,</span></span>
<span class="r-in"><span>                      newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"x1"</span> <span class="op">=</span> <span class="va">x1</span><span class="op">[</span><span class="fl">1001</span><span class="op">:</span><span class="fl">2000</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Use pred_val_probs to validate the predicted risks against the</span></span></span>
<span class="r-in"><span><span class="co">#observed outcomes</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">pred_val_probs</span><span class="op">(</span>binary_outcome <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1001</span><span class="op">:</span><span class="fl">2000</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                        Prob <span class="op">=</span> <span class="va">pred_risk</span>,</span></span>
<span class="r-in"><span>                        cal_plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calibration Measures </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> --------------------------------- </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         Estimate Lower 95% Confidence Interval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed:Expected Ratio   0.8018                        0.6740</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calibration Intercept    -0.2585                       -0.4563</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calibration Slope         1.2460                        0.7817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         Upper 95% Confidence Interval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed:Expected Ratio                        0.9539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calibration Intercept                         -0.0608</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calibration Slope                              1.7102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Also examine the calibration plot, if produced. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Discrimination Measures </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> --------------------------------- </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Estimate Lower 95% Confidence Interval Upper 95% Confidence Interval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AUC   0.6523                        0.5998                        0.7048</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall Performance Measures </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> --------------------------------- </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cox-Snell R-squared: 0.0211</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Nagelkerke R-squared: 0.0416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Brier Score (CI): 0.098 (0.0832, 0.1128)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Also examine the distribution plot of predicted risks. </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Glen P. Martin, David Jenkins, Matthew Sperrin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

